
<html>
    <!--
    <meta http-equiv="refresh" content="5">
    -->
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
    
        <style>
            body,html {
            margin:0;
            padding:0;
            }
            canvas {
                background-color: #311440;
            }
        </style>
    </head>
    
    <body>
        
        <input type="range" id="sliderTime" value="90"><div id="hour" style="display: inline">0</div>
        <canvas></canvas>
        
    </body>
        
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src = "https://rawgit.com/noeldelgado/Values.js/master/index.js"></script>
    <script src="https://rawgit.com/mourner/suncalc/master/suncalc.js"></script>
    <script src="LightCalculator.js"></script>
	<script src="Objects.js"></script>
    <script src="WeatherGrabber.js"></script>
    <script src="WeatherDrawer.js"></script>
    <script src="ForegroundDrawer.js"></script>
    <script src="BackgroundDrawer.js"></script>
    
    <script>
        
        weather = new Weather();
		var date = new Date();
        
		tryGrabbingWeatherInfo();
		
		function tryGrabbingWeatherInfo(){
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition,showError);
			} else {
				console.log("failed to grab geolocation");
			}
		}
        
        var canvas = document.querySelector('canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        function update(){
            if(canvas.width != window.innerWidth || canvas.height != window.innerHeight){
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            draw();
        }
        
        function draw(){
            drawBackground(canvas,weather);
            drawForeground(canvas,weather);
            drawWeather(canvas,weather);
			drawWeatherInformation();
        }
        
		//consider using onwindowstart or something
        update();
        setInterval ( update, 32 );//~30fps if my math is right
		setInterval ( tryGrabbingWeatherInfo, 120000 );//attempt grabbing weather conditions every 2 minutes
        
        function showPosition(position) {
            
            weather = grabWeatherConditions(position.coords.latitude,position.coords.longitude)
        }
		
		
		function drawWeatherInformation(){
			
			date = new Date();
			
			ctx.beginPath();
			ctx.rect(20,canvas.height-120,200,100);
			ctx.fillStyle = 'Black';
			ctx.fill();
			
			ctx.beginPath();
			ctx.rect(25,canvas.height-115,190,90);
			ctx.fillStyle = 'White';
			ctx.fill();
			
			//render text
			ctx.beginPath();
			ctx.fillStyle = 'black';
			ctx.font = "12px Georgia";
			ctx.fillText(date.getHours()+":"+date.getMinutes(),30,canvas.height-100);
			ctx.fillText(weather.location,30,canvas.height-85);
			ctx.fillText(weather.location,30,canvas.height-85);
			ctx.fillText(weather.inOneWord,30,canvas.height-70);
			ctx.fillText(weather.curTemp+" F",30,canvas.height-55);
			ctx.fillText(weather.windSpeed+" mph winds",30,canvas.height-40);
		}

        function showError(error) {
            var errorString;
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorString = "User denied the request for Geolocation."
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorString = "Location information is unavailable."
                    break;
                case error.TIMEOUT:
                    errorString = "The request to get user location timed out."
                    break;
                case error.UNKNOWN_ERROR:
                    errorString = "An unknown error occurred."
                    break;
            }
            console.log(errorString);
        }
    
    </script>
    
    
    
<html>